// prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")  // Supabase pooled URL
  directUrl = env("DIRECT_URL")    // Supabase direct URL
}

// ---------- TENANT ----------

model Tenant {
  id                  String      @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  slug                String
  name                String
  status              String      @default("active")
  primaryContactEmail String?     @map("primary_contact_email")
  notes               String?
  createdAt           DateTime    @map("created_at") @default(now()) @db.Timestamptz(6)
  updatedAt           DateTime    @map("updated_at") @default(now()) @db.Timestamptz(6)

  // Relations
  jobs            Job[]
  clientCompanies ClientCompany[]

  @@map("tenants")
}

// ---------- CLIENT COMPANY ----------

model ClientCompany {
  id        String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tenantId  String   @map("tenant_id") @db.Uuid
  name      String
  slug      String?
  logoUrl   String?  @map("logo_url")
  createdAt DateTime @map("created_at") @default(now()) @db.Timestamptz(6)

  // Relations
  tenant Tenant @relation(fields: [tenantId], references: [id])
  jobs   Job[]

  @@map("client_companies")
}

// ---------- JOB ----------

model Job {
  id                 String     @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tenantId           String     @map("tenant_id") @db.Uuid
  externalId         String?    @map("external_id")
  title              String
  department         String?
  location           String?
  employmentType     String?    @map("employment_type")
  seniority          String?
  description        String?
  hiringManagerId    String?    @map("hiring_manager_id") @db.Uuid
  status             String     @default("open")
  visibility         String     @default("public")
  tags               String[]   @db.Text
  createdBy          String?    @map("created_by") @db.Uuid
  createdAt          DateTime   @map("created_at") @default(now()) @db.Timestamptz(6)
  updatedAt          DateTime   @map("updated_at") @default(now()) @db.Timestamptz(6)
  slug               String?
  clientCompanyId    String?    @map("client_company_id") @db.Uuid
  workMode           String?    @map("work_mode")
  overview           String?
  aboutClient        String?    @map("about_client")
  responsibilities   String?
  requirements       String?
  benefits           String?
  shortDescription   String?    @map("short_description")
  locationType       String?    @map("location_type")
  experienceLevel    String?    @map("experience_level")
  yearsExperienceMin Int?       @map("years_experience_min")
  yearsExperienceMax Int?       @map("years_experience_max")
  salaryMin          Decimal?   @map("salary_min")  @db.Numeric
  salaryMax          Decimal?   @map("salary_max")  @db.Numeric
  salaryCurrency     String?    @map("salary_currency")
  salaryVisible      Boolean?   @map("salary_visible")
  requiredSkills     String[]?  @map("required_skills") @db.Text
  educationRequired  String?    @map("education_required")
  educationField     String?    @map("education_field")
  internalOnly       Boolean?   @map("internal_only")
  confidential       Boolean?   @map("confidential")
  screeningSchema    Json?      @map("screening_schema")

  // Relations
  tenant        Tenant         @relation(fields: [tenantId], references: [id])
  clientCompany ClientCompany? @relation(fields: [clientCompanyId], references: [id])

  @@map("jobs")
}
