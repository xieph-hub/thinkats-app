// prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")  // pooled
  directUrl = env("DIRECT_URL")    // direct
}

enum ApplicationStage {
  APPLIED
  SCREENING
  HM_INTERVIEW
  PANEL
  OFFER
  HIRED
  REJECTED
}

enum ApplicationStatus {
  PENDING
  REVIEWING
  SHORTLISTED
  REJECTED
  HIRED
}

model Tenant {
  id          String @id @default(cuid())
  name        String
  slug        String @unique

  // Relations
  jobs            Job[]           @relation("TenantJobs")
  clientCompanies ClientCompany[] @relation("TenantClientCompanies")
  candidates      Candidate[]     @relation("TenantCandidates")
  talentRequests  TalentRequest[]

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model ClientCompany {
  id          String   @id @default(cuid())
  tenant      Tenant   @relation("TenantClientCompanies", fields: [tenantId], references: [id])
  tenantId    String

  name        String
  slug        String
  logoUrl     String?
  websiteUrl  String?
  location    String?
  industry    String?
  size        String?  // e.g. "11–50", "51–200"

  // One client company can have many jobs
  jobs        Job[]

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Slug unique per tenant
  @@unique([tenantId, slug])
  @@index([tenantId])
}

model Job {
  id               String           @id @default(cuid())

  // Tenant / board this job belongs to
  tenant           Tenant           @relation("TenantJobs", fields: [tenantId], references: [id])
  tenantId         String

  // Client company (employer) – optional so you can also post “Resourcin Anonymous” jobs
  clientCompany    ClientCompany?   @relation(fields: [clientCompanyId], references: [id])
  clientCompanyId  String?

  title            String
  slug             String
  location         String
  employmentType   String           // "Full-time", "Contract", etc.
  seniority        String           // "Junior", "Mid", "Senior"
  function         String           // "Engineering", "Product", "Sales", etc.
  tags             String[]         // e.g. ["Remote", "Nigeria", "Fintech"]

  summary          String           // short teaser / intro
  description      String           // full job description (HTML/Markdown/plain)

  isPublished      Boolean          @default(true)

  // One job → many applications
  applications     JobApplication[]

  createdAt        DateTime         @default(now())
  updatedAt        DateTime         @updatedAt

  // Slug unique per tenant
  @@unique([tenantId, slug])
  @@index([tenantId])
}

model Candidate {
  id                    String             @id @default(cuid())
  tenant                Tenant             @relation("TenantCandidates", fields: [tenantId], references: [id])
  tenantId              String

  fullName              String
  email                 String
  phone                 String?
  location              String?
  linkedinUrl           String?
  yearsOfExperience     Int?
  currentRole           String?
  currentCompany        String?
  primaryFunction       String?            // "Engineering", "Product", etc.
  seniority             String?            // "Junior", "Mid", "Senior"
  skills                String[]           // e.g. ["Python", "SQL"]

  cvUrl                 String?            // latest uploaded CV URL
  notes                 String?            // internal notes

  // One candidate → many applications
  applications          JobApplication[]

  createdAt             DateTime           @default(now())
  updatedAt             DateTime           @updatedAt

  // Email unique per tenant
  @@unique([tenantId, email])
  @@index([tenantId])
}

model JobApplication {
  id           String             @id @default(cuid())

  // Link back to job
  job          Job                @relation(fields: [jobId], references: [id])
  jobId        String

  // Link back to candidate (optional – for one-off applications without full profile)
  candidate    Candidate?         @relation(fields: [candidateId], references: [id])
  candidateId  String?

  fullName     String
  email        String
  phone        String?
  location     String?
  linkedinUrl  String?
  portfolioUrl String?

  cvUrl        String?            // stored file URL (e.g. Supabase Storage)
  coverLetter  String?
  source       String?            // "Website", "Referral", "LinkedIn", etc.

  stage        ApplicationStage   @default(APPLIED)
  status       ApplicationStatus  @default(PENDING)

  createdAt    DateTime           @default(now())
  updatedAt    DateTime           @updatedAt

  @@index([jobId])
  @@index([candidateId])
}

model TalentRequest {
  id             String   @id @default(cuid())
  tenant         Tenant   @relation(fields: [tenantId], references: [id])
  tenantId       String

  companyName    String
  contactName    String
  contactEmail   String
  contactPhone   String?

  roleTitle      String
  roleLevel      String?   // e.g. "Senior", "Manager"
  function       String?   // e.g. "Engineering", "Sales"
  location       String?
  workType       String?   // "Onsite", "Remote", "Hybrid"
  employmentType String?   // "Full-time", "Contract", etc.

  budgetCurrency String?   // "USD", "NGN", etc.
  budgetMin      Int?
  budgetMax      Int?
  hiresCount     Int?

  notes          String?
  status         String   @default("new")

  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  @@index([tenantId])
}
