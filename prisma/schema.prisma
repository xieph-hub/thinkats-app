// prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model Tenant {
  id        String   @id @default(cuid())
  name      String
  slug      String   @unique
  type      String?  // e.g. "AGENCY", "CLIENT" if you want later

  jobs            Job[]
  clientCompanies ClientCompany[]
  candidates      Candidate[]
  pipelineStages  PipelineStage[]
  jobApplications JobApplication[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model ClientCompany {
  id        String  @id @default(cuid())
  tenantId  String
  tenant    Tenant  @relation(fields: [tenantId], references: [id])

  name       String
  slug       String?  @unique
  logoUrl    String?
  websiteUrl String?
  isActive   Boolean  @default(true)

  jobs            Job[]
  jobApplications JobApplication[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Job {
  id        String  @id @default(cuid())
  tenantId  String
  tenant    Tenant  @relation(fields: [tenantId], references: [id])

  clientCompanyId String?
  clientCompany   ClientCompany? @relation(fields: [clientCompanyId], references: [id])

  title            String
  slug             String?  @unique
  shortDescription String?
  description      String?
  department       String?
  location         String?
  locationType     String?   // "ONSITE" | "HYBRID" | "REMOTE" etc if you want to standardise later
  employmentType   String?   // "FULL_TIME" | "PART_TIME" | "CONTRACT" | ...
  seniority        String?
  tags             String[]  @default([])

  isPublished    Boolean  @default(false)
  isPublic       Boolean  @default(true)
  isConfidential Boolean  @default(false)
  status         String   @default("OPEN")  // "OPEN" | "ON_HOLD" | "CLOSED" etc
  publishedAt    DateTime?

  applications JobApplication[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([tenantId, status])
}

model Candidate {
  id        String  @id @default(cuid())
  tenantId  String
  tenant    Tenant  @relation(fields: [tenantId], references: [id])

  fullName        String
  email           String
  phone           String?
  currentCompany  String?
  currentTitle    String?
  location        String?
  cvUrl           String?
  source          String?   // "DIRECT_APPLY", "TALENT_NETWORK", etc
  isTalentNetwork Boolean   @default(false)

  applications JobApplication[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([tenantId, email])
  @@index([tenantId])
}

model PipelineStage {
  id        String  @id @default(cuid())
  tenantId  String
  tenant    Tenant  @relation(fields: [tenantId], references: [id])

  name      String
  sortOrder Int
  isDefault Boolean @default(false)

  applications JobApplication[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([tenantId, sortOrder])
}

model JobApplication {
  id        String  @id @default(cuid())
  tenantId  String
  tenant    Tenant  @relation(fields: [tenantId], references: [id])

  jobId   String
  job     Job     @relation(fields: [jobId], references: [id])

  candidateId String
  candidate   Candidate @relation(fields: [candidateId], references: [id])

  clientCompanyId String?
  clientCompany   ClientCompany? @relation(fields: [clientCompanyId], references: [id])

  pipelineStageId String?
  pipelineStage   PipelineStage? @relation(fields: [pipelineStageId], references: [id])

  status      String   @default("IN_REVIEW") // "IN_REVIEW", "SHORTLISTED", "REJECTED", etc
  source      String?  // "careers_site", "referral", etc
  cvUrl       String?
  submittedAt DateTime?

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([tenantId, jobId])
  @@index([pipelineStageId])
}

// Optional; you can keep this or delete it if you no longer need it.
// It doesn't hurt anything to leave it.
model PrismaPlaceholder {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())
}
