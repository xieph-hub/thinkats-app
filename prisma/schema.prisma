generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model Tenant {
  id        String   @id @default(cuid())
  name      String
  slug      String   @unique

  jobs            Job[]
  clientCompanies ClientCompany[]
  candidates      Candidate[]
  pipelineStages  PipelineStage[]
  jobApplications JobApplication[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model ClientCompany {
  id        String  @id @default(cuid())
  tenantId  String
  tenant    Tenant  @relation(fields: [tenantId], references: [id])

  name       String
  slug       String?  @unique
  logoUrl    String?
  websiteUrl String?
  isActive   Boolean  @default(true)

  jobs            Job[]
  jobApplications JobApplication[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Job {
  id        String  @id @default(cuid())
  tenantId  String
  tenant    Tenant  @relation(fields: [tenantId], references: [id])

  clientCompanyId String?
  clientCompany   ClientCompany? @relation(fields: [clientCompanyId], references: [id])

  title            String
  slug             String?  @unique
  shortDescription String?
  description      String?
  department       String?
  location         String?
  locationType     String?
  employmentType   String?
  seniority        String?
  tags             String[]

  isPublished    Boolean  @default(false)
  isPublic       Boolean  @default(true)
  isConfidential Boolean  @default(false)
  status         String   @default("OPEN")
  publishedAt    DateTime?

  applications JobApplication[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Candidate {
  id        String  @id @default(cuid())
  tenantId  String
  tenant    Tenant  @relation(fields: [tenantId], references: [id])

  fullName        String
  email           String
  phone           String?
  currentCompany  String?
  currentTitle    String?
  location        String?
  cvUrl           String?
  source          String?
  isTalentNetwork Boolean  @default(false)

  applications JobApplication[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([tenantId, email])
}

model PipelineStage {
  id        String  @id @default(cuid())
  tenantId  String
  tenant    Tenant  @relation(fields: [tenantId], references: [id])

  name      String
  sortOrder Int
  isDefault Boolean @default(false)

  applications JobApplication[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model JobApplication {
  id        String  @id @default(cuid())
  tenantId  String
  tenant    Tenant  @relation(fields: [tenantId], references: [id])

  jobId     String
  job       Job     @relation(fields: [jobId], references: [id])

  candidateId String
  candidate   Candidate @relation(fields: [candidateId], references: [id])

  clientCompanyId String?
  clientCompany   ClientCompany? @relation(fields: [clientCompanyId], references: [id])

  pipelineStageId String?
  pipelineStage   PipelineStage? @relation(fields: [pipelineStageId], references: [id])

  status      String   @default("IN_REVIEW")
  source      String?
  cvUrl       String?
  submittedAt DateTime?

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

// Optional: keep your placeholder or delete it
model PrismaPlaceholder {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())
}
