// prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
}

enum ApplicationStage {
  APPLIED
  SCREENING
  HM_INTERVIEW
  PANEL
  OFFER
  HIRED
  REJECTED
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")  // pooled
  directUrl = env("DIRECT_URL")    // direct
}

model ClientCompany {
  id          String   @id @default(cuid())
  tenant      Tenant   @relation(fields: [tenantId], references: [id])
  tenantId    String

  name        String
  slug        String   @unique
  logoUrl     String?
  websiteUrl  String?
  location    String?
  industry    String?
  size        String?  // e.g. "11–50", "51–200"

  // One client company can have many jobs
  jobs        Job[]

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Job {
  id               String           @id @default(cuid())

  // Tenant / board this job belongs to
  tenant           Tenant           @relation(fields: [tenantId], references: [id])
  tenantId         String

  // Client company (employer) – optional so you can also post “Resourcin Anonymous” jobs
  clientCompany    ClientCompany?   @relation(fields: [clientCompanyId], references: [id])
  clientCompanyId  String?

  title            String
  slug             String           @unique
  location         String
  employmentType   String           // "Full-time", "Contract", etc.
  seniority        String           // "Junior", "Mid", "Senior"
  function         String           // "Engineering", "Product", "Sales", etc.
  tags             String[]         // e.g. ["Remote", "Nigeria", "Fintech"]

  summary          String           // short teaser / intro
  description      String           // full job description (HTML/Markdown/plain)

  isPublished      Boolean          @default(true)

  createdAt        DateTime         @default(now())
  updatedAt        DateTime         @updatedAt

  // One job → many applications
  applications     JobApplication[]
}

model Candidate {
  id                    String   @id @default(cuid())
  fullName              String
  email                 String   @unique
  phone                 String?
  city                  String?
  country               String?
  headline              String?
  summary               String?
  currentRole           String?
  currentCompany        String?
  totalExperienceYears  Int?

  level                 String?  // graduate, mid, senior, executive
  functions             String?  // comma-separated list
  industries            String?  // comma-separated list
  skills                String?  // comma-separated list

  preferredLocations    String?  // comma-separated; e.g. "Nigeria,Ghana,Remote"
  workPreference        String?  // remote, onsite, hybrid
  salaryCurrency        String?
  salaryMin             Int?
  salaryMax             Int?
  noticePeriod          String?  // e.g. "Immediate", "1 month"

  cvUrl                 String?
  source                String?  // job_application, talent_network, referral
  status                String?  // active, inactive

  applications          JobApplication[]

  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt
}

model JobApplication {
  id          String   @id @default(cuid())

  job         Job      @relation(fields: [jobId], references: [id])
  jobId       String

  fullName    String
  email       String
  phone       String?
  location    String?
  linkedinUrl String?
  portfolioUrl String?

  cvUrl       String           // public URL from Supabase Storage
  coverLetter String?          // optional text
  source      String?          // e.g. "Website", "Referral"

  status      ApplicationStatus @default(PENDING)

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Tenant {
  id          String   @id @default(cuid())
  name        String
  slug        String   @unique
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  jobs        Job[]
}

enum ApplicationStatus {
  PENDING
  REVIEWING
  SHORTLISTED
  REJECTED
  HIRED
}
